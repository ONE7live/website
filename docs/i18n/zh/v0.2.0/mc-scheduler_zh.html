<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-i18n/zh/v0.2.0/mc-scheduler_zh" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">多集群调度器 | Kosmos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kosmos-io.github.io/website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kosmos-io.github.io/website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kosmos-io.github.io/website/i18n/zh/v0.2.0/mc-scheduler_zh"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="多集群调度器 | Kosmos"><meta data-rh="true" name="description" content="当 Kosmos 加入一个成员集群后，它会映射一个带有 kosmos.io/node=true:Noschedule 污点的虚拟节点，因此 Kubernetes 默认调度器无法将 Pod 调度到该虚拟节点（即成员集群）上。"><meta data-rh="true" property="og:description" content="当 Kosmos 加入一个成员集群后，它会映射一个带有 kosmos.io/node=true:Noschedule 污点的虚拟节点，因此 Kubernetes 默认调度器无法将 Pod 调度到该虚拟节点（即成员集群）上。"><link data-rh="true" rel="icon" href="/website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kosmos-io.github.io/website/i18n/zh/v0.2.0/mc-scheduler_zh"><link data-rh="true" rel="alternate" href="https://kosmos-io.github.io/website/i18n/zh/v0.2.0/mc-scheduler_zh" hreflang="en"><link data-rh="true" rel="alternate" href="https://kosmos-io.github.io/website/i18n/zh/v0.2.0/mc-scheduler_zh" hreflang="x-default"><link rel="stylesheet" href="/website/assets/css/styles.20bcec04.css">
<script src="/website/assets/js/runtime~main.8e85197a.js" defer="defer"></script>
<script src="/website/assets/js/main.0db9ee29.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/website/"><div class="navbar__logo"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kosmos</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/website/v0.2.0/getting-started/introduction">Documentation</a><a href="https://kosmos-io.github.io/website/v0.2.0/quick-start" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Examples<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>多集群调度器</h1>
<p>当 Kosmos 加入一个成员集群后，它会映射一个带有 <code>kosmos.io/node=true:Noschedule</code> 污点的虚拟节点，因此 Kubernetes 默认调度器无法将 Pod 调度到该虚拟节点（即成员集群）上。
部署 kosmos-scheduler 后，用户可以通过 kosmos-scheduler 中的 <code>LeafNodeTaintToleration</code> 调度插件容忍 <code>kosmos.io/node=true:Noschedule</code> 污点，从而实现成员集群和主机集群节点之间的混合调度效果。</p>
<p>对于带有 PV/PVC 的 Pod，还需在 kosmos-scheduler 中配置 <code>LeafNodeVolumeBinding</code> 调度插件，以在存储卷绑定过程中直接使用带有 <code>kosmos.io/node=true:Noschedule</code> 污点的虚拟节点。</p>
<p>需要注意的是，对于不同版本的 Kubernetes，发布的默认调度器所依赖的调度模块（调度框架）也会随版本变化而变化。目前，Kosmos 已适配了两个版本（<code>release-1.21.5</code> 和 <code>release-1.26.3</code>）。以下验证部分将使用 <code>release-1.21.5</code> 进行部署和测试。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="多集群调度器解决方案">多集群调度器解决方案<a href="#多集群调度器解决方案" class="hash-link" aria-label="Direct link to 多集群调度器解决方案" title="Direct link to 多集群调度器解决方案">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="Direct link to 简介" title="Direct link to 简介">​</a></h3>
<p>调度器框架最初通过 Kubernetes 增强提案中的 <a href="https://link.zhihu.com/?target=https%3A//github.com/kubernetes/enhancements/tree/master/keps/sig-scheduling/624-scheduling-framework" target="_blank" rel="noopener noreferrer">624-scheduling-framework</a> 提案引入，主要实现以下目标：</p>
<ul>
<li>使调度器更加可扩展。</li>
<li>通过将一些功能移至插件，使调度器核心更简单。</li>
<li>在框架中提出扩展点。</li>
<li>提出根据收到的结果继续或中止的插件结果接收机制。</li>
<li>提出处理错误并将其与插件通信的机制。</li>
</ul>
<p>为此，调度器框架定义了多个扩展点，如下图所示：
<img decoding="async" loading="lazy" alt="MC_Scheduler.png" src="/website/assets/images/MC_Scheduler-4e0d264782f68e38b5d41dc36731c7fe.png" width="1366" height="613" class="img_ev3q"></p>
<p>kosmos-scheduler 中的 <code>LeafNodeTaintToleration</code> 和 <code>LeafNodeVolumeBinding</code> 调度插件主要是基于 Kubernetes 默认调度器的 <code>NodeTaintToleration</code> 和 <code>NodeVolumeBinding</code> 调度插件进行优化的。
<code>LeafNodeTaintToleration</code> 插件主要在 <code>Filter</code> 扩展点中为虚拟节点上的 <code>kosmos.io/node=true:Noschedule</code> 污点添加容忍。
<code>LeafNodeVolumeBinding</code> 插件主要在 <code>Filter</code>、<code>Reserve</code>、<code>Unreserved</code> 和 <code>PreBind</code> 扩展点上起作用，并直接传递带有 <code>kosmos.io/node=true:Noschedule</code> 污点的虚拟节点。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="先决条件">先决条件<a href="#先决条件" class="hash-link" aria-label="Direct link to 先决条件" title="Direct link to 先决条件">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-kosmos">安装 Kosmos<a href="#安装-kosmos" class="hash-link" aria-label="Direct link to 安装 Kosmos" title="Direct link to 安装 Kosmos">​</a></h4>
<p>参考 Kosmos 快速入门文档 <a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer">https://github.com/kosmos-io/kosmos</a> 并为多集群网络启用 ClusterLink 模块。使用 kosmosctl 工具：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kosmosctl install --cni calico --default-nic eth0 // 我们基于传递的网络接口值构建网络隧道</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>至少部署 clustertree 模块并正确加入叶子集群。</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="加入叶子集群">加入叶子集群<a href="#加入叶子集群" class="hash-link" aria-label="Direct link to 加入  叶子集群" title="Direct link to 加入叶子集群">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kosmosctl join cluster --name cluster1 --kubeconfig ~/kubeconfig/cluster1-kubeconfig --cni calico --default-nic eth0 --enable-link</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="部署-kosmos-scheduler">部署 Kosmos-scheduler<a href="#部署-kosmos-scheduler" class="hash-link" aria-label="Direct link to 部署 Kosmos-scheduler" title="Direct link to 部署 Kosmos-scheduler">​</a></h3>
<ol>
<li>配置调度器和调度策略：</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># kosmos-scheduler 调度策略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: scheduler-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kosmos-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scheduler-config.yaml: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apiVersion: kubescheduler.config.k8s.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: KubeSchedulerConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    leaderElection:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      leaderElect: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resourceName: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resourceNamespace: kosmos-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - schedulerName: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        plugins:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          preFilter:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;VolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;LeafNodeVolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          filter:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;VolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;TaintToleration&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;LeafNodeTaintToleration&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;LeafNodeVolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          score:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;VolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          reserve:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;VolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;LeafNodeVolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          preBind:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;VolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;LeafNodeVolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pluginConfig:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - name: LeafNodeVolumeBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              bindTimeoutSeconds: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 调度器配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kosmos-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    component: scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      component: scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        component: scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: scheduler-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          configMap:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name: scheduler-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            defaultMode: 420</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          image: ghcr.io/kosmos-io/scheduler:0.0.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - --config=/etc/kubernetes/kube-scheduler/scheduler-config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              cpu: 200m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - name: scheduler-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              readOnly: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              mountPath: /etc/kubernetes/kube-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          livenessProbe:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            httpGet:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              path: /healthz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              port: 10259</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              scheme: HTTPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            initialDelaySeconds: 15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            periodSeconds: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            failureThreshold: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          readinessProbe:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            httpGet:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              path: /healthz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              port: 10259</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              scheme: HTTPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      restartPolicy: Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dnsPolicy: ClusterFirst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serviceAccountName: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serviceAccount: kosmos-scheduler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>验证 kosmos-scheduler 服务：</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建 kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n kosmos-system get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                         READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-scheduler-8f96d87d7-ssxrx             1/1     Running   0          24s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例">示例<a href="#示例" class="hash-link" aria-label="Direct link to 示例" title="Direct link to 示例">​</a></h4>
<ol>
<li>
<p>在测试集群上部署 openebs</p>
</li>
<li>
<p>使用案例 yaml（mysql-cluster.yaml）</p>
</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: test-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: my-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type: Opaque</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # 需要指定 root 密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ROOT_PASSWORD: ${your_password}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ## 在集群启动时创建的应用凭据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # DATABASE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # USER:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # PASSWORD:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: MysqlCluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: test-mysql-cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: test-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  secretName: my-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: docker.io/percona:5.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mysqlVersion: &quot;5.7&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  podSpec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    affinity:         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      podAntiAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              mysql.presslabs.org/cluster: test-mysql-cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          topologyKey: kubernetes.io/hostname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumeSpec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      storageClassName: openebs-hostpath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      accessModes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          storage: 1Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>操作说明</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 显示主机集群中的所有节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       STATUS     ROLES                       AGE   VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmoscluster1-1           Ready      control-plane,master,node   21d   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmoscluster1-2           Ready      node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        21d   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-member2-cluster-1   Ready      agent                       24m   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-member2-cluster-2   Ready      agent                       24m   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 显示虚拟节点上的污点信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe node kosmos-member2-cluster-1  |grep Tai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Taints:             node.kubernetes.io/unreachable:NoExecute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe node kosmos-member2-cluster-2  |grep Tai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Taints:             node.kubernetes.io/unreachable:NoExecute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 kosmos-scheduler 进行（混合）调度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f  mysql-cluster.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 在主机集群中显示实例（混合）调度结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -owide -n test-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            READY   STATUS    RESTARTS   AGE   IP               NODE                       NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test-mysql-cluster-mysql-0      4/4     Running   0          3m    2409:xxxxx:8ac   kosmoscluster1-2           &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test-mysql-cluster-mysql-1      4/4     Running   0          2m    2409:xxxxx:8ae   kosmos-member2-cluster-1   &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 在成员集群中显示实例（混合）调度结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -owide -n test-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            READY   STATUS    RESTARTS   AGE   IP               NODE                       NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test-mysql-cluster-mysql-1      4/4     Running   0          2m    2409:xxxxx:8ae   kosmos-member2-cluster-1   &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="结论">结论<a href="#结论" class="hash-link" aria-label="Direct link to 结论" title="Direct link to 结论">​</a></h3>
<p>可以看到，kosmos-scheduler 成功将用户实例的 Pod 调度到了主机集群和成员集群中。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/i18n/zh/v0.2.0/multi-cluster-scheduler_zh.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#多集群调度器解决方案" class="table-of-contents__link toc-highlight">多集群调度器解决方案</a><ul><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#先决条件" class="table-of-contents__link toc-highlight">先决条件</a></li><li><a href="#部署-kosmos-scheduler" class="table-of-contents__link toc-highlight">部署 Kosmos-scheduler</a></li><li><a href="#结论" class="table-of-contents__link toc-highlight">结论</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Address Name<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>