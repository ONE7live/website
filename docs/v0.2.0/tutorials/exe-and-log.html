<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-v0.2.0/tutorials/exe-and-log" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Design of EXE and Log in Kosmos | Kosmos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kosmos-io.github.io/website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kosmos-io.github.io/website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kosmos-io.github.io/website/v0.2.0/tutorials/exe-and-log"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Design of EXE and Log in Kosmos | Kosmos"><meta data-rh="true" name="description" content="Kosmos EXE and Log Solution"><meta data-rh="true" property="og:description" content="Kosmos EXE and Log Solution"><link data-rh="true" rel="icon" href="/website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/exe-and-log"><link data-rh="true" rel="alternate" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/exe-and-log" hreflang="en"><link data-rh="true" rel="alternate" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/exe-and-log" hreflang="x-default"><link rel="stylesheet" href="/website/assets/css/styles.281b787e.css">
<script src="/website/assets/js/runtime~main.7a9d914d.js" defer="defer"></script>
<script src="/website/assets/js/main.e4d54341.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/website/"><div class="navbar__logo"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kosmos</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/website/v0.2.0/getting-started/introduction">Documentation</a><a class="navbar__item navbar__link" href="/website/blog">Examples</a><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/getting-started/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/quick-start">Quick Start</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mcs-discovery">Multi-cluster Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mc-scheduler">Multi-cluster Scheduler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/website/v0.2.0/tutorials/exe-and-log">Design of EXE and Log in Kosmos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/node-not-ready">Kosmos Node NotReady</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/ipsec-network">IPsec Cross-cluster Network</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/k8s-in-k8s">Kubernetes in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/distribution-policy">Distribution Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/leaf-node-generate-rules">Leaf Node Generate Rules</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Design of EXE and Log in Kosmos</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Design of EXE and Log in Kosmos</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kosmos-exe-and-log-solution">Kosmos EXE and Log Solution<a href="#kosmos-exe-and-log-solution" class="hash-link" aria-label="Direct link to Kosmos EXE and Log Solution" title="Direct link to Kosmos EXE and Log Solution">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h3>
<p>In Kosmos, the pods scheduled to kosmos-node also support the kubectl exec and kubectl log functionalities.
Since the overall architecture of exec and log is the same, we will use exec as an example to explain the design approach.
The following diagram illustrates the overall design architecture.</p>
<p><img decoding="async" loading="lazy" alt="EXE Log_Arch.png" src="/website/assets/images/EXE_Log_Arch-55169f06d1b0071b36b0ddb300a3e3fd.png" width="1110" height="863" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="background-knowledge">Background Knowledge<a href="#background-knowledge" class="hash-link" aria-label="Direct link to Background Knowledge" title="Direct link to Background Knowledge">​</a></h3>
<p>First, let&#x27;s sort out how exec is implemented in k8s.
The leaf-cluster part of the architecture diagram is a representation of the exec function of a general cluster.
The kubectl exec request initiated by the user is processed by apiserver.
After receiving the exec request, apiserver needs to forward the request to the node where the pod is located, so it needs to query the information of the node where the pod is located.
In the k8s source code, apiserver will call the ExecLocation method to obtain the exec url of the pod.
The code is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ExecLocation returns the exec URL for a pod container. If opts.Container is blank</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// and only one container is present in the pod, that container is used.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func ExecLocation(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx context.Context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    getter ResourceGetter,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connInfo client.ConnectionInfoGetter,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    opts *api.PodExecOptions,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) (*url.URL, http.RoundTripper, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return streamLocation(ctx, getter, connInfo, name, opts, opts.Container, &quot;exec&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ExecLocation calls the streamLocation method, and streamLocation obtains pod information through the pod name.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func streamLocation(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx context.Context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    getter ResourceGetter,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connInfo client.ConnectionInfoGetter,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    opts runtime.Object,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path string,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) (*url.URL, http.RoundTripper, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pod, err := getPod(ctx, getter, name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return nil, nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Try to figure out a container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // If a container was provided, it must be valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container, err = validateContainer(container, pod)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return nil, nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodeName := types.NodeName(pod.Spec.NodeName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if len(nodeName) == 0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // If pod has not been assigned a host, return an empty location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return nil, nil, errors.NewBadRequest(fmt.Sprintf(&quot;pod %s does not have a host assigned&quot;, name))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodeInfo, err := connInfo.GetConnectionInfo(ctx, nodeName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return nil, nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    params := url.Values{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if err := streamParams(params, opts); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return nil, nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loc := &amp;url.URL{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Scheme:   nodeInfo.Scheme,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Host:     net.JoinHostPort(nodeInfo.Hostname, nodeInfo.Port),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Path:     fmt.Sprintf(&quot;/%s/%s/%s/%s&quot;, path, pod.Namespace, pod.Name, container),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RawQuery: params.Encode(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return loc, nodeInfo.Transport, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then the node name where the pod is located is obtained through pod.Spec.NodeName, and then a key method GetConnectionInfo is called. The code is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// GetConnectionInfo retrieves connection info from the status of a Node API object.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (k *NodeConnectionInfoGetter) GetConnectionInfo(ctx context.Context, nodeName types.NodeName) (*ConnectionInfo, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node, err := k.nodes.Get(ctx, string(nodeName), metav1.GetOptions{})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Find a kubelet-reported address, using preferred address type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    host, err := nodeutil.GetPreferredNodeAddress(node, k.preferredAddressTypes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Use the kubelet-reported port, if present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port := int(node.Status.DaemonEndpoints.KubeletEndpoint.Port)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if port &lt;= 0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port = k.defaultPort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &amp;ConnectionInfo{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Scheme:                         k.scheme,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Hostname:                       host,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Port:                           strconv.Itoa(port),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Transport:                      k.transport,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        InsecureSkipTLSVerifyTransport: k.insecureSkipTLSVerifyTransport,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }, nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>GetConnectionInfo obtains the node information through the node name, then uses GetPreferredNodeAddress to select a suitable host, and then through the previous streamLocation processing, an exec request URL is pieced together.
The apiserver will know which node to forward the exec request to.
The kubelet service running on the node will capture the exec request and then establish a link with the pod.</p>
<p>The above briefly introduces the process of establishing kubectl exec.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-in-kosmos">Implementation in Kosmos<a href="#implementation-in-kosmos" class="hash-link" aria-label="Direct link to Implementation in Kosmos" title="Direct link to Implementation in Kosmos">​</a></h3>
<p>Now let&#x27;s take a look at the part in the root cluster in the overall architecture diagram.
To enable exec requests to be forwarded to the leaf cluster, a service similar to kubelet needs to be launched to listen for the exec requests.
In the clustertree-cluster-manager service, we start a nodeServer service, as shown in the following code snippet:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nodeServer := nodeserver.NodeServer{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RootClient:        mgr.GetClient(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GlobalLeafManager: globalleafManager,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go func() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if err := nodeServer.Start(ctx, opts); err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        klog.Errorf(&quot;failed to start node server: %v&quot;, err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This service listens for exec and log requests and acts as a proxy to forward the received requests to the corresponding leaf cluster.
The source code snippet is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func (s *NodeServer) AttachRoutes(m *http.ServeMux) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r := mux.NewRouter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r.StrictSlash(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r.HandleFunc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;/containerLogs/{namespace}/{pod}/{container}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        api.ContainerLogsHandler(s.getClient),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ).Methods(&quot;GET&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r.HandleFunc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;/exec/{namespace}/{pod}/{container}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        api.ContainerExecHandler(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            api.ContainerExecOptions{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                StreamIdleTimeout:     30 * time.Second,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                StreamCreationTimeout: 30 * time.Second,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            s.getClient,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ).Methods(&quot;POST&quot;, &quot;GET&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r.NotFoundHandler = http.HandlerFunc(api.NotFound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    m.Handle(&quot;/&quot;, r)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With the forwarding part completed, we need to make the API server in the root cluster recognize the communication address of the kosmos-node as the address of the clustertree-cluster-manager service.
Therefore, when maintaining the status of kosmos-node, we synchronize the podIP of clustertree-cluster-manager to kosmos-node.
The complete process is as follows:</p>
<ul>
<li>The user initiates an exec request.</li>
<li>The API server in the root cluster receives the exec request and queries the node information based on the pod information.</li>
<li>The queried node host is the podIP of clustertree-cluster-manager.</li>
<li>The API server in the root cluster establishes an exec connection with clustertree-cluster-manager.</li>
<li>clustertree-cluster-manager receives the exec connection request, queries the pod information, and proxies the exec request to the leaf cluster.
With this process, Kosmos implements the exec functionality, and the log functionality works in the same way.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="customization">Customization<a href="#customization" class="hash-link" aria-label="Direct link to Customization" title="Direct link to Customization">​</a></h3>
<p>When connecting with es products, there is a customized requirement.
The above design will cause the IPs of all kosmos-node to be the podIPs of clustertree-cluster-manage.
In the product design of es, nodeIP is used as the primary key, which causes the product to fail to be stored in the warehouse.
For this purpose, kosmos has made a special design.
The ip address in the node information obtained through kubectl get node -owide is of the InternalIP type.</p>
<p><img decoding="async" loading="lazy" alt="EXE_Log_2.png" src="/website/assets/images/EXE_Log_2-ea8e4f188ee387a763b309b043e50ccb.png" width="1818" height="158" class="img_ev3q"></p>
<p>The function GetPreferredNodeAddress used by the apiserver mentioned above when querying the host of the node will select one from the Address list according to the priority, so in es, we set the podIP of clustertree-cluster-manage as other priority higher than the InternalIP category address, as shown below, you can specify the type of ip and the value of ip.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func GetAddress(ctx context.Context, rootClient kubernetes.Interface, originAddress []corev1.NodeAddress) ([]corev1.NodeAddress, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    preferredAddressType := corev1.NodeAddressType(os.Getenv(&quot;PREFERRED-ADDRESS-TYPE&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if len(preferredAddressType) == 0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        preferredAddressType = corev1.NodeInternalDNS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefixAddress := []corev1.NodeAddress{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {Type: preferredAddressType, Address: os.Getenv(&quot;LEAF_NODE_IP&quot;)},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address, err := SortAddress(ctx, rootClient, originAddress)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return append(prefixAddress, address...), nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>How to check address priority? By looking at the startup parameter of api-server - kubelet-preferred-address-types, the GetPreferredNodeAddress function is set here to obtain the priority of the host.
By default, InternalDNS has the highest priority.</p>
<p><img decoding="async" loading="lazy" alt="EXE_Log_3.png" src="data:image/png;base64,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" width="855" height="52" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h3>
<p>In Kosmos, both kubectl exec and kubectl log are &quot;tricked&quot; by the API server and redirected to our own clustertree-cluster-manager service.
This allows us to implement customized features in subsequent steps.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/v0.2.0/tutorials/design-of-exe-and-log.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/website/v0.2.0/tutorials/mc-scheduler"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Multi-cluster Scheduler</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/website/v0.2.0/tutorials/node-not-ready"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kosmos Node NotReady</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#kosmos-exe-and-log-solution" class="table-of-contents__link toc-highlight">Kosmos EXE and Log Solution</a><ul><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#background-knowledge" class="table-of-contents__link toc-highlight">Background Knowledge</a></li><li><a href="#implementation-in-kosmos" class="table-of-contents__link toc-highlight">Implementation in Kosmos</a></li><li><a href="#customization" class="table-of-contents__link toc-highlight">Customization</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Address Name<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>